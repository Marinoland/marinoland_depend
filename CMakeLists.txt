cmake_minimum_required(VERSION 2.8)
project (depend)


function(fetch_depends listpath)
	IF(EXISTS ${listpath})
		FILE(STRINGS ${listpath} DEPENDLIST)
		list(REMOVE_DUPLICATES DEPENDLIST)
		foreach(repo ${DEPENDLIST})
			if(EXISTS ./${repo})
					MESSAGE("Skipping ${repo}. Already there.")
			else()
				set(REPOURL git@github.com:Marinoland/marinoland_${repo}.git)
				execute_process(COMMAND git clone ${REPOURL} ${repo})
				fetch_depends(./${repo}/depend.list)
				execute_process(COMMAND cmake -DDEP_ROOT:STRING=../../ . WORKING_DIRECTORY ${repo})
				execute_process(COMMAND cmake --build . --config Release WORKING_DIRECTORY ./${repo})

				file(STRINGS ./${repo}/depend.libs tmp)
				foreach(line ${tmp})
					file(APPEND depend.libs ${line} \n)
				endforeach()
				file(STRINGS ./${repo}/depend.includedirs tmp)
				foreach(line ${tmp})
					file(APPEND depend.includedirs ${line} \n)
				endforeach()
				file(STRINGS ./${repo}/depend.linkdirs tmp)
				foreach(line ${tmp})
					file(APPEND depend.linkdirs ${line} \n)
				endforeach()
				file(STRINGS ./${repo}/depend.defs tmp)
				foreach(line ${tmp})
					file(APPEND depend.defs ${line} \n)
				endforeach()
			endif()
		endforeach()
	ENDIF()
endfunction()

file(WRITE depend.libs "")
file(WRITE depend.includedirs "")
file(WRITE depend.linkdirs "")
file(WRITE depend.defs "")
fetch_depends(../depend.list)
